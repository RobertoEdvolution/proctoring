document.cookie="permiso=1";let e=!1;define(["jquery","core/ajax","core/notification"],function(t,i,n){function a(){var e=t(".submitbtns").html();t(".submitbtns").html(e+'<p style="margin: 10px;position: absolute;padding:25px"><b>NOTA:</b>Se recomienda utilizar una c√°mara web en esta prueba, sin embargo, no es obligatorio.</p><br>')}t("#id_submitbutton").prop("disabled",!1),t(function(){t("#id_submitbutton").prop("disabled",!1),t("#id_proctoring").on("change",function(){this.checked&&e?(t("#id_submitbutton").prop("disabled",!1),document.cookie="permiso=1"):t("#id_submitbutton").prop("disabled",!1)})});const o=()=>{try{const e=document.getElementsByClassName("alert");e.length>0&&Array.from(e).forEach(e=>{e.style.display="none"})}catch(e){console.log(e)}};let c=3e4;const s=async(e,t)=>{const i=await faceapi.detectAllFaces(e);if(0===i.length)console.log("Face not found");else{let n=i[0].box;await(async(e,t,i)=>{const n=[new faceapi.Rect(t.x,t.y,t.width,t.height)];let a=await faceapi.extractFaces(e,n);0===a.length?console.log("Face not found"):a.forEach(e=>{i.src=e.toDataURL()})})(e,n,t)}return i.length};return{async setup(d,r){if(await faceapi.nets.ssdMobilenetv1.loadFromUri(r),c=d.camshotdelay,null!==document.getElementById("page-mod-quiz-summary")&&document.getElementById("page-mod-quiz-summary").innerHTML.length)return!1;if(null!==document.getElementById("page-mod-quiz-review")&&document.getElementById("page-mod-quiz-review").innerHTML.length)return!1;const l=d.image_width;let u=0,g=!1,m=null;t("#mod_quiz_navblock").append('<div class="card-body p-3"><h3 class="no text-left">Webcam</h3> <br/><video id="video">Video stream not available.</video><img id="cropimg" src="" alt=""/><canvas id="canvas" style="display:none;"></canvas><div class="output" style="display:none;"><img id="photo" alt="The picture will appear in this box."/></div></div>');const h=document.getElementById("video"),p=document.getElementById("canvas"),b=document.getElementById("photo"),f=async()=>{const e=p.getContext("2d");if(l&&u){p.width=l,p.height=u,e.drawImage(h,0,0,l,u),m=p.toDataURL("image/png"),b.setAttribute("src",m),d.webcampicture=m;let c=t("#cropimg");await s(b,c);let r,g;c.src?(o(),r=1,g=c.src):(r=0,g="");var a={methodname:"quizaccess_proctoring_send_camshot",args:{courseid:d.courseid,screenshotid:d.id,quizid:d.quizid,webcampicture:m,imagetype:1,parenttype:"camshot_image",faceimage:g,facefound:r}};i.call([a])[0].done(function(e){e.warnings.length>=1&&h&&n.addNotification({message:"Something went wrong during taking the image.",type:"error"})}).fail(n.exception)}else(()=>{const e=p.getContext("2d");e.fillStyle="#AAA",e.fillRect(0,0,p.width,p.height),m=p.toDataURL("image/png"),b.setAttribute("src",m)})()};return navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(function(t){h.srcObject=t,h.play(),e=!0}).catch(function(){a()}),h?(h.addEventListener("canplay",function(){g||(u=h.videoHeight/(h.videoWidth/l),isNaN(u)&&(u=l/(4/3)),h.setAttribute("width",l),h.setAttribute("height",u),p.setAttribute("width",l),p.setAttribute("height",u),g=!0)},!1),h.addEventListener("click",async function(e){await f(),e.preventDefault()},!1),setTimeout(f,3e3),setInterval(f,c)):a(),!0},async init(o){let c=0,s=!1,d=null,r=null,l=null,u=null;const g=o.image_width;function m(){if(e){var t=r.getContext("2d");t.fillStyle="#AAA",t.fillRect(0,0,r.width,r.height),u=r.toDataURL("image/png"),l.setAttribute("src",u)}else a()}return await async function(){d=document.getElementById("video"),r=document.getElementById("canvas"),l=document.getElementById("photo"),d?(navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(function(t){d.srcObject=t,d.play(),e=!0}).catch(function(){n.addNotification({message:o.allowcamerawarning,type:"warning"}),a()}),d.addEventListener("canplay",function(){s||(c=d.videoHeight/(d.videoWidth/g),isNaN(c)&&(c=g/(4/3)),d.setAttribute("width",g),d.setAttribute("height",c),r.setAttribute("width",g),r.setAttribute("height",c),s=!0)},!1),d.addEventListener("click",async function(e){await async function(){var e=r.getContext("2d");if(g&&c){t(document).trigger("screenshoottaken"),r.width=g,r.height=c,e.drawImage(d,0,0,g,c),u=r.toDataURL("image/png"),l.setAttribute("src",u);var a={methodname:"quizaccess_proctoring_send_camshot",args:{courseid:o.courseid,screenshotid:o.id,quizid:o.quizid,webcampicture:u,imagetype:1}};i.call([a])[0].done(async function(e){e.warnings.length>=1&&n.addNotification({message:"Something went wrong during taking screenshot.",type:"error"})}).fail(n.exception)}else m()}(),e.preventDefault()},!1)):a(),m()}(),u}}});
//# sourceMappingURL=proctoring.min.js.map